<!DOCTYPE html>
<html>
	<head>
		<script src="three.min.js"></script>
        <script src="kanji.js"></script>
        <script src="THREE.CSG.js"></script>        
	</head>
	
	<body onload="main()">
	    	<h1>ф.н. 81394 &ndash; група 3 &ndash; Антони Калоферов</h1>

		<script>
			var material = new THREE.MeshPhongMaterial({color:'gray',shininess:100});
            
            //array of all objects
            var sceneObjects = new Array();

            //mid segment of kanji
            var mid_bottom = new THREE.Mesh( new THREE.BoxGeometry(14.5,1,6), material );
            mid_bottom.position.set(0,-4,0);
            var mid_top = new THREE.Mesh( new THREE.BoxGeometry(12,1,6), material );
			mid_top.position.set(0,-1.5,0);
            var mid_left = new THREE.Mesh( new THREE.BoxGeometry(1,4,6), material );
            mid_left.position.set(-2.1,-1.75,0);
            var mid_right = new THREE.Mesh( new THREE.BoxGeometry(1,4,6), material );
            mid_right.position.set(2.1,-1.75,0);
            
            //convert meshes to csg objects and add to main array
            var mid_bottom_csg = THREE.CSG.fromMesh(mid_bottom);
            var mid_top_csg = THREE.CSG.fromMesh(mid_top);
            var mid_left_csg = THREE.CSG.fromMesh(mid_left);
            var mid_right_csg = THREE.CSG.fromMesh(mid_right);
            sceneObjects.push(mid_bottom_csg, mid_top_csg, mid_left_csg, mid_right_csg);
            
            //left number 2 looking part of the kanji
            var left_2_top = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            left_2_top.position.set(-3.25,5,0);
            var left_2_right = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            left_2_right.position.set(-1,4,0);
            var left_2_mid = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            left_2_mid.position.set(-3.25,3,0);
            var left_2_left = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            left_2_left.position.set(-5.5,2,0);
            var left_2_bottom = new THREE.Mesh( new THREE.BoxGeometry(3.5,1,6), material );
            left_2_bottom.position.set(-3.25,1,0);

            //small curve at the left bottom part of the 2 using spline and cylinders along the spline
            var left_2_curve_left = new THREE.SplineCurve( [
                new THREE.Vector2( -6, 1.5 ),
                new THREE.Vector2( -5.89, 0.61 ),
                new THREE.Vector2( -5, 0.5 )
            ] );
            var shape = new THREE.Shape();
			shape.moveTo( -6, 1.5 );
            shape.splineThru(left_2_curve_left.getPoints(50));
			shape.lineTo( -5, 1.5 );
			
			var extrudeSettings = {
				steps: 1,
				amount: 6,
				bevelEnabled: false
			};
			
            var left_2_left_curve = new THREE.Mesh( new THREE.ExtrudeGeometry( shape, extrudeSettings ), material ) ;
            left_2_left_curve.position.z -= 3;
            var left_2_left_curve_csg = THREE.CSG.fromMesh(left_2_left_curve);
			sceneObjects.push( left_2_left_curve_csg );            
            
            // //tail of left 2
            var left_2_curve_right = new THREE.SplineCurve( [
                new THREE.Vector2( -1.5, 0.5 ),
                new THREE.Vector2( -0.9, 0.54 ),
                new THREE.Vector2( -0.25, 0.85 ),
                new THREE.Vector2( 0.35, 2.15 )
            ] );
            var left_2_curve_right2 = new THREE.SplineCurve( [
                new THREE.Vector2( -0.57, 2.57 ),
                new THREE.Vector2( -0.76, 2.1 ),
                new THREE.Vector2( -1.04, 1.57 ),
                new THREE.Vector2( -1.5, 1.5 )
            ] );

            var shape1 = new THREE.Shape();
			shape1.moveTo( -1.5, 0.5 );
            shape1.splineThru(left_2_curve_right.getPoints(50));
            shape1.lineTo( -0.57, 2.57 );
            shape1.splineThru(left_2_curve_right2.getPoints(50));
            
            var left_2_right_curve = new THREE.Mesh( new THREE.ExtrudeGeometry( shape1, extrudeSettings ), material ) ;
            left_2_right_curve.position.z -= 3;
            var left_2_right_curve_csg = THREE.CSG.fromMesh(left_2_right_curve);
			sceneObjects.push( left_2_right_curve_csg );

            //convers left 2 kanji to csg object and add to main array
            var left_2_top_csg = THREE.CSG.fromMesh(left_2_top);
            var left_2_right_csg = THREE.CSG.fromMesh(left_2_right);
            var left_2_mid_csg = THREE.CSG.fromMesh(left_2_mid);
            var left_2_left_csg = THREE.CSG.fromMesh(left_2_left);
            var left_2_bottom_csg = THREE.CSG.fromMesh(left_2_bottom);
            sceneObjects.push(left_2_top_csg, left_2_right_csg, left_2_mid_csg, left_2_left_csg, left_2_bottom_csg);
            
            //right number 2 looking part of the kanji
            var right_2_top = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            right_2_top.position.set(3.25,5,0);
            var right_2_right = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            right_2_right.position.set(5.5,4,0);
            var right_2_mid = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            right_2_mid.position.set(3.25,3,0);
            var right_2_left = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            right_2_left.position.set(1,2,0);  
            var right_2_bottom = new THREE.Mesh( new THREE.BoxGeometry(3.5,1,6), material );
            right_2_bottom.position.set(3.25,1,0); 
            //small curve at right bottom of the 2 using spline and cylinders 
            var right_2_curve_left = new THREE.SplineCurve( [
                new THREE.Vector2( 0.5, 1.5 ),
                new THREE.Vector2( 0.6, 0.6 ),
                new THREE.Vector2( 1.5, 0.5 )
            ] );
            var shape2 = new THREE.Shape();
			shape2.moveTo( 0.5, 1.5 );
            shape2.splineThru(right_2_curve_left.getPoints(50));
			shape2.lineTo( 2, 1.5 );
			
            var right_2_left_curve = new THREE.Mesh( new THREE.ExtrudeGeometry( shape2, extrudeSettings ), material ) ;
            right_2_left_curve.position.z -= 3;
            var right_2_left_curve_csg = THREE.CSG.fromMesh(right_2_left_curve);
			sceneObjects.push( right_2_left_curve_csg );
            
            // //tail of right 2
            var right_2_curve_right = new THREE.SplineCurve( [
                new THREE.Vector2( 5, 0.5 ),
                new THREE.Vector2( 5.85, 0.51 ),
                new THREE.Vector2( 6.25, 0.62 ),
                new THREE.Vector2( 6.55, 0.9 ),
                new THREE.Vector2( 6.82, 1.6 ),
                new THREE.Vector2( 6.95, 2.3 )
            ] );
            var right_2_curve_right2 = new THREE.SplineCurve( [
                new THREE.Vector2( 5.99, 2.65 ),
                new THREE.Vector2( 5.99, 2.3 ),
                new THREE.Vector2( 5.93, 1.86 ),
                new THREE.Vector2( 5.75, 1.54 ),
                new THREE.Vector2( 5, 1.5 ),
            ] );
            var shape3 = new THREE.Shape();
			shape3.moveTo( 5, 0.5 );
            shape3.splineThru(right_2_curve_right.getPoints(50));
            shape3.lineTo(5.99, 2.75);
            shape3.splineThru(right_2_curve_right2.getPoints(50));
			
            var right_2_right_curve = new THREE.Mesh( new THREE.ExtrudeGeometry( shape3, extrudeSettings ), material ) ;
            right_2_right_curve.position.z -= 3;
            var right_2_right_curve_csg = THREE.CSG.fromMesh(right_2_right_curve);
			sceneObjects.push( right_2_right_curve_csg );
            
            //convert right 2 kanji to csg object and add to main array
            var right_2_top_csg = THREE.CSG.fromMesh(right_2_top);
            var right_2_right_csg = THREE.CSG.fromMesh(right_2_right);
            var right_2_mid_csg = THREE.CSG.fromMesh(right_2_mid);
            var right_2_left_csg = THREE.CSG.fromMesh(right_2_left);
            var right_2_bottom_csg = THREE.CSG.fromMesh(right_2_bottom);
            sceneObjects.push(right_2_top_csg, right_2_right_csg, right_2_mid_csg, right_2_left_csg, right_2_bottom_csg);

            //bottom left curved line
            var left_bottom = new THREE.SplineCurve( [
                new THREE.Vector2( -7.7, -6.5 ),
                new THREE.Vector2( -5.2, -6.2 ),
                new THREE.Vector2( -3.5, -5.7 ),
                new THREE.Vector2( -1.7, -4.9 )
            ] );
            var left_bottom2 = new THREE.SplineCurve( [
                new THREE.Vector2( -0.9, -5.6 ),
                new THREE.Vector2( -3.1, -6.7 ),
                new THREE.Vector2( -5.7, -7.3 ),
                new THREE.Vector2( -7.1, -7.45 )
            ] );
        
            var shape4 = new THREE.Shape();
			shape4.moveTo( -7.7, -6.5 );
            shape4.splineThru(left_bottom.getPoints(50));
            shape4.lineTo(-0.9, -5.6);
            shape4.splineThru(left_bottom2.getPoints(50));
			
            var left_bottom_line = new THREE.Mesh( new THREE.ExtrudeGeometry( shape4, extrudeSettings ), material ) ;
            left_bottom_line.position.z -= 3;
            var left_bottom_line_csg = THREE.CSG.fromMesh(left_bottom_line);
			sceneObjects.push( left_bottom_line_csg );

            // //mirroring matrix for bottom right line
            var mS = (new THREE.Matrix4()).identity();
            mS.elements[5] = -1;
            mS.elements[10] = -1;
            
            var right_bottom_line = left_bottom_line.clone();
            right_bottom_line.applyMatrix(mS);
            right_bottom_line.position.set(8.5, -12.2, 3);
            var right_bottom_line_csg = THREE.CSG.fromMesh(right_bottom_line);
            sceneObjects.push(right_bottom_line_csg);

            //USING THREE.CSG.js FROM HERE ON TO SLICE KANJI

            var heart = new THREE.Mesh(new THREE.BoxGeometry(0,0,0), material);
            var result = THREE.CSG.fromMesh(heart);
            sceneObjects.forEach(function(element) {
                result = result.union(element);
            });

            var slicing_cube_right = new THREE.Mesh(new THREE.BoxGeometry(26,26,26), material);
            slicing_cube_right.position.set(9.24,9.24,2);
            slicing_cube_right.rotation.z = Math.PI/4 - 0.08;
            var slice_left = THREE.CSG.fromMesh(slicing_cube_right);

            result_left = result.subtract(slice_left);
            result_right = result.intersect(slice_left);
            
            var mesh_left = THREE.CSG.toMesh(result_left, material);
            var mesh_right = THREE.CSG.toMesh(result_right, material);
            part1.add(mesh_right);
            part2.add(mesh_left);
		</script>
	</body>
</html>