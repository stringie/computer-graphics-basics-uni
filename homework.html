<!DOCTYPE html>
<html>
	<head>
		<script src="three.min.js"></script>
        <script src="kanji.js"></script>
        <script src="THREE.CSG.js"></script>        
	</head>
	
	<body onload="main()">
	    	<h1>ф.н. 81394 &ndash; група 3 &ndash; Антони Калоферов</h1>

		<script>
			
			var material = new THREE.MeshPhongMaterial({color:'gray',shininess:100});
            
            var sceneObjects = new Array();

            //mid segment of kanji
            var mid_bottom = new THREE.Mesh( new THREE.BoxGeometry(14.5,1,6), material );
            mid_bottom.position.set(0,-4,0);
            var mid_top = new THREE.Mesh( new THREE.BoxGeometry(12,1,6), material );
			mid_top.position.set(0,-1.5,0);
            var mid_left = new THREE.Mesh( new THREE.BoxGeometry(1,4,6), material );
            mid_left.position.set(-2.1,-1.75,0);
            var mid_right = new THREE.Mesh( new THREE.BoxGeometry(1,4,6), material );
            mid_right.position.set(2.1,-1.75,0);
            
            //convert meshes to csg objects and add to main array
            var mid_bottom_csg = THREE.CSG.fromMesh(mid_bottom);
            var mid_top_csg = THREE.CSG.fromMesh(mid_top);
            var mid_left_csg = THREE.CSG.fromMesh(mid_left);
            var mid_right_csg = THREE.CSG.fromMesh(mid_right);
            sceneObjects.push(mid_bottom_csg, mid_top_csg, mid_left_csg, mid_right_csg);
            
            //left number 2 looking part of the kanji
            var left_2_top = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            left_2_top.position.set(-3.25,5,0);
            var left_2_right = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            left_2_right.position.set(-1,4,0);
            var left_2_mid = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            left_2_mid.position.set(-3.25,3,0);
            var left_2_left = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            left_2_left.position.set(-5.5,2,0);
            var left_2_bottom = new THREE.Mesh( new THREE.BoxGeometry(3.5,1,6), material );
            left_2_bottom.position.set(-3.25,1,0);

            //small curve at the left bottom part of the 2 using spline and cylinders along the spline
            var left_2_curve_left = new THREE.SplineCurve( [
                new THREE.Vector2( -5.5, 1.5 ),
                new THREE.Vector2( -5.45, 1.05 ),
                new THREE.Vector2( -5, 1 )
            ] );
            left_2_curve_left.getSpacedPoints(20).forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x, element.y ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });
            
            //tail of left 2
            var left_2_curve_right = new THREE.SplineCurve( [
                new THREE.Vector2( -1.5, 1 ),
                new THREE.Vector2( -1, 1.034 ),
                new THREE.Vector2( -0.6, 1.3 ),
                new THREE.Vector2( -0.1-0.2, 2.2-0.2 )
            ] );
            left_2_curve_right.getSpacedPoints(20).forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x, element.y ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });
            var tail_cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            tail_cube.position.set(-0.3, 2, 0);
            tail_cube.rotation.z = 1.21;

            //convers left 2 kanji to csg object and add to main array
            var left_2_top_csg = THREE.CSG.fromMesh(left_2_top);
            var left_2_right_csg = THREE.CSG.fromMesh(left_2_right);
            var left_2_mid_csg = THREE.CSG.fromMesh(left_2_mid);
            var left_2_left_csg = THREE.CSG.fromMesh(left_2_left);
            var left_2_bottom_csg = THREE.CSG.fromMesh(left_2_bottom);
            var tail_cube_csg = THREE.CSG.fromMesh(tail_cube);
            sceneObjects.push(left_2_top_csg, left_2_right_csg, left_2_mid_csg, left_2_left_csg, left_2_bottom_csg, tail_cube_csg);
            
            //right number 2 looking part of the kanji
            var right_2_top = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            right_2_top.position.set(3.25,5,0);
            var right_2_right = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            right_2_right.position.set(5.5,4,0);
            var right_2_mid = new THREE.Mesh( new THREE.BoxGeometry(5.5,1,6), material );
            right_2_mid.position.set(3.25,3,0);
            var right_2_left = new THREE.Mesh( new THREE.BoxGeometry(1,1,6), material );
            right_2_left.position.set(1,2,0);  
            var right_2_bottom = new THREE.Mesh( new THREE.BoxGeometry(3.5,1,6), material );
            right_2_bottom.position.set(3.25,1,0); 
            //small curve at right bottom of the 2 using spline and cylinders 
            var right_2_curve_left = new THREE.SplineCurve( [
                
                new THREE.Vector2( 1, 1.5 ),
                new THREE.Vector2( 1.05, 1.05 ),
                new THREE.Vector2( 1.5, 1 )
            ] );
            right_2_curve_left.getSpacedPoints(20).forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x, element.y ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });        
            
            //tail of right 2
            var right_2_curve_right = new THREE.SplineCurve( [
                new THREE.Vector2( 5, 1 ),
                new THREE.Vector2( 5.5, 1.007 ),
                new THREE.Vector2( 6, 1.1 ),
                new THREE.Vector2( 6.35, 1.5 ),
                new THREE.Vector2( 6.43, 2 )
            ] );
            right_2_curve_right.getSpacedPoints(20).forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x, element.y ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });
            var tail_cube1 = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            tail_cube1.position.set(6.43, 2, 0);
            tail_cube1.rotation.z = 1.46;
            //small triangle next to tail_cube1
            var tail_cube_triangle_end = new THREE.Mesh(new THREE.CylinderGeometry(0.615,0.615, 6, 3), material);
            tail_cube_triangle_end.position.set(6.38,2.29,0);
            tail_cube_triangle_end.rotation.x = Math.PI/2;
            tail_cube_triangle_end.rotation.y = -0.27;
            
            //convert right 2 kanji to csg object and add to main array
            var right_2_top_csg = THREE.CSG.fromMesh(right_2_top);
            var right_2_right_csg = THREE.CSG.fromMesh(right_2_right);
            var right_2_mid_csg = THREE.CSG.fromMesh(right_2_mid);
            var right_2_left_csg = THREE.CSG.fromMesh(right_2_left);
            var right_2_bottom_csg = THREE.CSG.fromMesh(right_2_bottom);
            var tail_cube1_csg = THREE.CSG.fromMesh(tail_cube1);
            var tail_cube_triangle_end_csg = THREE.CSG.fromMesh(tail_cube_triangle_end);
            sceneObjects.push(right_2_top_csg, right_2_right_csg, right_2_mid_csg, right_2_left_csg, right_2_bottom_csg, tail_cube1_csg, tail_cube_triangle_end_csg);

            //bottom left curved line
            var left_bottom = new THREE.SplineCurve( [
                new THREE.Vector2( -6.8, -7 ),
                new THREE.Vector2( -5.2, -6.72 ),
                new THREE.Vector2( -3.5, -6.18 ),
                new THREE.Vector2( -2, -5.4 )
            ] );
            left_bottom.getSpacedPoints(60).forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x, element.y ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });

            var bottom_left_line_top_cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            bottom_left_line_top_cube.position.set(-2, -5.4, 0);
            bottom_left_line_top_cube.rotation.z = 0.52;
            
            var bottom_left_line_bottom_cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            bottom_left_line_bottom_cube.position.set(-6.8, -7, 0);
            bottom_left_line_bottom_cube.rotation.z = 0.14;
            
            var bottom_left_line_left_cube_triangle = new THREE.Mesh(new THREE.CylinderGeometry(0.65,0.65, 6, 3), material);
            bottom_left_line_left_cube_triangle.position.set(-7.17,-6.92,0);
            bottom_left_line_left_cube_triangle.rotation.x = Math.PI/2;
            bottom_left_line_left_cube_triangle.rotation.y = -0.1;
            
            var bottom_left_line_right_cube_triangle = new THREE.Mesh(new THREE.CylinderGeometry(0.61,0.61, 6, 3), material);
            bottom_left_line_right_cube_triangle.position.set(-1.73,-5.33,0);
            bottom_left_line_right_cube_triangle.rotation.x = Math.PI/2;
            bottom_left_line_right_cube_triangle.rotation.y = -0.9;

            //convert bottom left line to csg object and add to main array
            var bottom_left_line_bottom_cube_csg = THREE.CSG.fromMesh(bottom_left_line_bottom_cube);
            var bottom_left_line_top_cube_csg = THREE.CSG.fromMesh(bottom_left_line_top_cube);
            var bottom_left_line_left_cube_triangle_csg = THREE.CSG.fromMesh(bottom_left_line_left_cube_triangle);
            var bottom_left_line_right_cube_triangle_csg = THREE.CSG.fromMesh(bottom_left_line_right_cube_triangle);
            sceneObjects.push(bottom_left_line_bottom_cube_csg, bottom_left_line_top_cube_csg, bottom_left_line_left_cube_triangle_csg, bottom_left_line_right_cube_triangle_csg)

            //mirroring matrix for bottom right line
            var mS = (new THREE.Matrix4()).identity();
            mS.elements[5] = -1;
            mS.elements[10] = -1;
            
            var right_bottom = new THREE.SplineCurve( [
                new THREE.Vector2( 2.2, -7 ),
                new THREE.Vector2( 3.8, -6.72 ),
                new THREE.Vector2( 5.5, -6.18 ),
                new THREE.Vector2( 7, -5.4 )
            ] );
            
            var path = new THREE.Path( right_bottom.getPoints( 60 ) );
            var geometry1 = path.createPointsGeometry( 60 );
            geometry1.applyMatrix(mS);

            geometry1.vertices.forEach(function(element) {
                var cylinder = new THREE.Mesh( new THREE.CylinderGeometry(0.5,0.5,6,50), material );
                cylinder.position.set(element.x - 0.4, element.y-12.4 ,0);
                cylinder.rotation.x = Math.PI/2;
                var cylinder_csg = THREE.CSG.fromMesh(cylinder);
                sceneObjects.push(cylinder_csg);
            });
            var bottom_right_line_top_cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            bottom_right_line_top_cube.position.set(1.8, -5.4, 0);
            bottom_right_line_top_cube.rotation.z = -0.14;
            
            var bottom_right_line_bottom_cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,6), material);
            bottom_right_line_bottom_cube.position.set(6.6, -7, 0);
            bottom_right_line_bottom_cube.rotation.z = -0.51;
            
            var bottom_right_line_left_cube_triangle = new THREE.Mesh(new THREE.CylinderGeometry(0.65,0.65, 6, 3), material);
            bottom_right_line_left_cube_triangle.position.set(1.38,-5.47,0);
            bottom_right_line_left_cube_triangle.rotation.x = Math.PI/2;
            bottom_right_line_left_cube_triangle.rotation.y = -1;

            //convert bottom rigth line to csg object and add to main array
            var bottom_right_line_bottom_cube_csg = THREE.CSG.fromMesh(bottom_right_line_bottom_cube);
            var bottom_right_line_top_cube_csg = THREE.CSG.fromMesh(bottom_right_line_top_cube);
            var bottom_right_line_left_cube_triangle_csg = THREE.CSG.fromMesh(bottom_right_line_left_cube_triangle);
            sceneObjects.push(bottom_right_line_bottom_cube_csg, bottom_right_line_top_cube_csg, bottom_right_line_left_cube_triangle_csg);

            //USING THREE.CSG.js FROM HERE ON TO SLICE KANJI

            var heart = new THREE.Mesh(new THREE.BoxGeometry(0,0,0), material);
            var result = THREE.CSG.fromMesh(heart);
            sceneObjects.forEach(function(element) {
                result = result.union(element);
            });

            var slicing_cube_right = new THREE.Mesh(new THREE.BoxGeometry(26,26,26), material);
            slicing_cube_right.position.set(9.24,9.24,2);
            slicing_cube_right.rotation.z = Math.PI/4 - 0.08;
            var slice_left = THREE.CSG.fromMesh(slicing_cube_right);

            var slicing_cube_left = new THREE.Mesh(new THREE.BoxGeometry(26,26,26), material);
            slicing_cube_left.position.set(-9.24,-9.24,2);
            slicing_cube_left.rotation.z = Math.PI/4 - 0.08;
            var slice_right = THREE.CSG.fromMesh(slicing_cube_left);

            result_left = result.subtract(slice_left);
            result_right = result.subtract(slice_right);
            
            var mesh_left = THREE.CSG.toMesh(result_left, material);
            var mesh_right = THREE.CSG.toMesh(result_right, material);
            part1.add(mesh_right);
            part2.add(mesh_left);
		</script>
	</body>
</html>